# text-based-robot-trajectory-control
# 基于文本的工业机器人轨迹运动控制

这是一个在生产实习中开发的工业机器人二次开发项目，旨在通过基于文本的指令，实现对博创（Betrun）工业机器人轨迹运动的控制。项目利用Modbus TCP协议与机器人进行通信，并通过一个Web界面提供直观的用户交互。

## 技术栈 (Technology Stack)

-   **后端**: Python (使用 Flask 框架)
    -   **Modbus通信**: `pymodbus` 库用于实现Modbus TCP通信，负责与博创机器人进行数据读写。
    -   **Web框架**: `Flask` 用于构建轻量级的API服务，处理前端请求并与Modbus客户端交互。
    -   **跨域支持**: `Flask-CORS` 扩展用于处理前端跨域请求。
    -   **日志**: Python内置的 `logging` 模块用于记录后端操作和调试信息。
    -   **数据转换**: `struct` 模块用于处理浮点数与Modbus寄存器16位整数之间的转换，以适应博创系统的Modbus数据映射（小端模式）。
    -   **文本解析**: `re` (正则表达式) 模块用于解析和规范化用户输入的中文或英文文本指令。

-   **前端**: HTML, CSS (Tailwind CSS), JavaScript
    -   **界面**: `index.html` 构建了用户操作界面，包括指令输入、状态显示和操作按钮。
    -   **样式**: `Tailwind CSS` 用于快速构建和定制响应式、现代化的用户界面。
    -   **交互**: 原生JavaScript负责处理用户输入、发送HTTP请求到后端API、更新机器人状态显示以及日志输出。
    -   **异步通信**: `fetch API` 用于与后端进行异步数据交互，确保用户界面的流畅性。

## 项目概述 (Project Overview)

本项目核心目标是简化工业机器人的操作和编程，通过简单的文本指令就能控制机器人的复杂运动轨迹，从而降低对传统示教器操作的依赖，提高生产效率和易用性。

### 主要功能

1.  **指令标准化与解析**: 能够识别并规范化用户输入的中文或英文文本指令（例如："移动 J1 30", "设置速度 50", "全轴回零" 等）。
2.  **Modbus通信**: 通过Modbus TCP协议与博创机器人控制器进行稳定可靠的数据交互，包括读取机器人状态、写入控制指令、设置运动参数等。
3.  **机器人运动控制**: 支持多种机器人运动控制，如：
    * **自动模式切换**: 将机器人切换到自动运行模式。
    * **增量运动**: 控制机器人关节或基坐标系下沿指定方向运动指定距离/角度。
    * **速度设置**: 动态调整机器人运动速度。
    * **回零操作**: 支持单轴或全轴回零。
    * **运动控制**: 暂停、继续、停止当前运动。
    * **通用变量读写**: 支持对机器人全局变量（GV0）的读写操作，方便测试和调试。
4.  **实时状态监控**: 前端通过轮询机制实时显示机器人的当前模式、运行状态、报警状态以及自定义的GV0测试值。
5.  **运动过程等待与报警处理**: 后端逻辑包含等待运动完成的机制，并在运动过程中检测并报告机器人报警状态，确保操作安全。

### 文件说明

-   `app.py`: Flask后端应用程序，包含Modbus通信逻辑、指令处理和API接口。
-   `index.html`: 前端用户界面文件。
-   `博创系统modbus从站运动控制功能2023.12.22-V3.0.pdf`: 博创机器人Modbus从站运动控制功能文档（版本V3.0），详细说明了Modbus地址映射、功能码和运动控制功能。
-   `控制系统编址说明v2.3_201214（scara）.pdf`: 博创机器人控制系统编址说明（版本V2.3），提供了全局变量和Modbus地址的详细信息。
-   `广东培高科技有限公司控制系统使用说明书202210_解密.pdf`: 广东培高科技有限公司的控制系统使用说明书，提供了关于Betrun控制系统的全面编程和操作指南。

## 快速启动 (Quick Start)

1.  **克隆仓库**:
    ```bash
    git clone https://github.com/xicheng2003/text-based-robot-trajectory-control
    cd text-based-robot-trajectory-control
    ```
2.  **安装Python依赖**:
    ```bash
    pip install Flask Flask-Cors pymodbus
    ```
3.  **配置机器人IP**:
    打开 `app.py`，根据你的机器人实际IP地址修改 `ROBOT_IP` 变量。
    ```python
    ROBOT_IP = '192.168.0.11' # <-- 请根据你的机器人实际IP地址修改！
    ```
    打开 `index.html`，根据你的后端服务器的实际局域网IP地址修改 `BACKEND_COMMAND_URL` 和 `BACKEND_STATUS_URL`。
    ```javascript
    const BACKEND_COMMAND_URL = '[http://172.20.10.8:5000/command](http://172.20.10.8:5000/command)'; // <--- 请在这里修改为你的后端服务器的实际局域网IP地址！
    const BACKEND_STATUS_URL = '[http://172.20.10.8:5000/status](http://172.20.10.8:5000/status)';   // <--- 例如: '[http://192.168.0.100:5000/status](http://192.168.0.100:5000/status)'
    ```
4.  **运行后端服务**:
    ```bash
    python app.py
    ```
    服务将在 `http://0.0.0.0:5000` 上运行。
5.  **打开前端界面**:
    在浏览器中直接打开 `index.html` 文件即可。

## 使用说明 (Usage)

在Web界面中，你可以在“输入指令 (多行)”文本框中输入多行指令，然后点击“发送指令”按钮。

**支持的指令示例**:

-   `AUTO_MODE` 或 `自动模式`: 切换机器人到自动模式。
-   `SET_SPEED <速度值>` 或 `设置速度 <速度值>`: 设置机器人运动速度（例如：`SET_SPEED 50`）。如果未指定速度值，将使用默认值 100。
-   `MOVE J<1-6> <角度>` 或 `移动 J<1-6> <角度>`: 控制指定关节轴进行增量运动（例如：`MOVE J1 30`）。
-   `MOVE X/Y/Z/A/B/C <距离/角度>` 或 `移动 X/Y/Z/A/B/C <距离/角度>`: 控制指定基坐标系轴进行增量运动（例如：`MOVE X 100`）。
-   `GO_HOME_J<1-6>` 或 `回零 J<1-6>`: 控制指定关节轴回零（例如：`GO_HOME_J1`）。
-   `GO_HOME_ALL` 或 `全轴回零`: 控制所有关节轴回零。
-   `PAUSE_MOVE` 或 `暂停运动`: 暂停当前机器人运动。
-   `CONTINUE_MOVE` 或 `继续运动`: 继续被暂停的机器人运动。
-   `STOP_MOVE` 或 `停止运动`: 立即停止当前机器人运动。
-   `MONITOR` 或 `状态监控`: 触发前端状态轮询（通常由前端自动处理）。
-   `TEST_WRITE_GV0 <值>` 或 `测试写入GV0 <值>`: 向全局变量GV0写入一个浮点测试值（例如：`TEST_WRITE_GV0 123.45`）。

**重要提示**:

-   `MOVE` 和 `GO_HOME` 指令会触发机器人实际运动，后端会等待运动完成。
-   在执行任何运动指令前，请确保机器人处于安全环境中，并已正确配置。

## 贡献 (Contribution)

欢迎对本项目提出改进意见或贡献代码！如果你发现任何问题或有新功能建议，请提交 Issue 或 Pull Request。

## 许可证 (License)

本项目采用 MIT 许可证。详见 `LICENSE` 文件。

---
